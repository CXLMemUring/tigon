This repository contains source code for Pasha. The code is based on [lotus](https://github.com/DBOS-project/lotus).

# Setup Environment

```sh
# install gh
curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | sudo dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg \
&& sudo chmod go+r /usr/share/keyrings/githubcli-archive-keyring.gpg \
&& echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" | sudo tee /etc/apt/sources.list.d/github-cli.list > /dev/null \
&& sudo apt update \
&& sudo apt install gh -y

# gh login
gh auth login

# clone the repo
git clone https://github.com/pasha-project/pasha.git && cd pasha

# setup the current machine (the script will reboot the machine)
./scripts/setup.sh cur_host

# rebooting...
cd pasha

# build the image for our VMs after the reboot
./scripts/setup.sh vm_image

# setup dependencies
./scripts/setup.sh deps

# launch VMs
./scripts/setup.sh launch_vms chameleon 8 # we will launch 8 VMs each with 5 cores

# setup VMs
./scripts/setup.sh vms 8
```

# Setup Environment for the UIUC machine

```sh
# setup the bluefield NIC
/storage/ut_austin/pasha/vhive_setup/linux_qemu/bluefield.sh

# rebooting...
sudo daxctl reconfigure-device --mode=system-ram dax0.0 --force

# launch VMs
sudo ./scripts/setup.sh launch_vms uiuc 8 # we will launch 8 VMs each with 5 cores

# setup VMs
./scripts/setup.sh vms 8
```

# Build and Run Experiments

```sh
# build and sync
./scripts/run.sh COMPILE_SYNC 8 # we use 8 VMs

# run TPCC experiments (see run.sh for detailed usage)
./scripts/run.sh TPCC SundialPasha 8 2 10 15 1 NoMoveOut OnDemand 0 90 60 0

# run YCSB experiments (see run.sh for detailed usage)
./scripts/run.sh YCSB SundialPasha 8 2 40960 50 0 10 1 NoMoveOut OnDemand 0 60 30 0

# run a set of experiments to collect statistics for migration policies
./scripts/migration_policy_stats.sh 10 15 10

# run a set of experiments to measure the overhead of multi-host transactions
./scripts/remote_txn_overhead.sh
```

# Parse Results

```sh
# parse results generated by migration_policy_stats.sh
./scripts/plot/parse_migration_policy_stats.py res_dir

# parse results generated by migration_policy_stats.sh and plot figures
./scripts/plot/parse_remote_txn_overhead.py res_dir
./scripts/plot/plot-tpcc-remote-txn-overhead.py res_dir
./scripts/plot/plot-ycsb-remote-txn-overhead.py res_dir # TODO
```
